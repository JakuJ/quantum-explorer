@page "/"
@using Explorer.Utilities.ComponentTree
@using Newtonsoft.Json
@inject IJSRuntime JsRuntime;

<div id="splitPanes">
    @Components
</div>

@code {

    RenderFragment Components => new PanelRenderer().Render(tree);

    readonly PanelTree tree = new PanelTree(PanelTree.Alignment.Horizontal);

    protected override void OnInitialized()
    {
        base.OnInitialized();
        tree.AddPanel(new Editor());

        var sidePanel = new PanelTree(PanelTree.Alignment.Vertical);
        sidePanel.AddPanel(new Compositor());
        sidePanel.AddPanel(new Visualizer());

        tree.AddPanel(sidePanel);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            string serializedTree = JsonConvert.SerializeObject(tree, new JsonSerializerSettings
            {
                TypeNameHandling = TypeNameHandling.Auto
            });
            JsRuntime.InvokeVoidAsync("Library.InitializeSplitPanes", serializedTree);
        }
    }

}
