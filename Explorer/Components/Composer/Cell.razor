@using Microsoft.Extensions.Logging
@using Common
@inject ILogger<Cell> Logger;

<SnapPoint X="@X" Y="@Y" Half="@false" @ref="snapPoint" Locked="@(QuantumGate.HasValue)"/>
<div class="grid-cell">
    @if (QuantumGate.HasValue)
    {
        <Gate Name="@(QuantumGate.Value.Name)" @ref="gate"/>
    }
    else
    {
        <button class="grid-blankcell-button" @onclick="OnClick"/>
    }
</div>
@if(!QuantumGate.HasValue && clicked)
{
    <AddGateMenu ExitMenu="@ExitAddGateMenu" Left="@(50*X)"/>
}

@code {

    private Gate? gate;

    private SnapPoint snapPoint = null!;

    private bool clicked { get; set; } = false;

    [Parameter]
    public QuantumGate? QuantumGate { get; set; }

    [Parameter]
    public int X { get; set; }

    [Parameter]
    public int Y { get; set; }

    [Parameter]
    public Dictionary<string, SnapPoint> SnapPoints { get; set; } = null!;

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            SnapPoints.Add(snapPoint.Id, snapPoint);
        }

        if (gate != null)
        {
            SnapPoints[gate.Id] = snapPoint;
        }
    }
    private void OnClick(MouseEventArgs e)
    {
        Logger.LogDebug($"Click cell  X={X}  Y={Y}");
        clicked = true;
        StateHasChanged();
    }

    private void ExitAddGateMenu()
    {
        clicked = false;
        StateHasChanged();
    }
}
